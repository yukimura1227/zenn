---
title: "Wasmã‚„ãƒ¢ãƒ€ãƒ³ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’é§†ä½¿ã—ã¦Markdownã§LTè³‡æ–™ã‚’ä½œã£ã¦ã‚·ã‚§ã‚¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹æŠ€è¡“ã®è£å´"
emoji: "ğŸ“–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React","TypeScript","WebAssembly","Vite","WebContainers"]
published: true
---

![SlidevookLogo](https://storage.googleapis.com/zenn-user-upload/8e96a7950ee5-20230403.png)

## æ¦‚è¦

ã‚¹ãƒ©ã‚¤ãƒ‰å½¢å¼ã®è³‡æ–™ãŒå¥½ããªç­†è€…ãŒã€Markdownã§ãŠã—ã‚ƒã‚Œãªã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã¤ãã£ã¦ã€å³åº§ã«ã‚·ã‚§ã‚¢ã§ãã‚‹ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã€[Slidevook](https://slidevook.dev/pages/demo/)ã‚’é–‹ç™ºã—ãŸã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ”¯ãˆã‚‹æŠ€è¡“ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‚’ä½œã‚‰ãšã«ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æŠ€è¡“(Wasmã€WebContainerå«ã‚€)ã ã‘ã§ã€ä½œã‚Šåˆ‡ã‚‹ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã®ã§ã€å¹…åºƒãä½¿ã£ãŸæŠ€è¡“æƒ…å ±ã‚’å…±æœ‰ã§ãã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

## å¯¾è±¡èª­è€…

- æœ€æ–°ï¼ˆ2023å¹´4æœˆç¾åœ¨ï¼‰ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é€²åŒ–ã«è¿½å¾“ã—ãŸã„æ–¹
- WebContainerã®å®Ÿç”¨ä¾‹ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹
- Wasmã‚’åˆ©ç”¨ã—ãŸå‹•çš„OGPã®ç”Ÿæˆã«èˆˆå‘³ãŒã‚ã‚‹æ–¹
- ã‚ˆãLTã§ç™ºè¡¨ã‚’ã™ã‚‹æ–¹
- Markdownã§LTè³‡æ–™ã‚’ä½œæˆã™ã‚‹ã®ãŒå¥½ããªæ–¹
- ã¤ãã£ãŸLTè³‡æ–™ã‚’å…¬é–‹ã™ã‚‹ã®ã«ã€ã„ã¡ã„ã¡PDFåŒ–ã—ã¦ã¨ã„ã†ã®ãŒå¤§å¤‰ã¨ã„ã†æ–¹

## ã¤ãã£ãŸã‚‚ã®

[Slidevook](https://slidevook.dev/pages/demo/)ã¨ã„ã†ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã€[sli.dev](https://sli.dev/)ã¨ã„ã†ã€Markdownã§ç´ é©ãªSlideãŒä½œã‚Œã‚‹OSSã‚’åˆ©ç”¨ã—ã¦ã€Slideã‚’ã¤ãã£ã¦å…±æœ‰ã§ãã‚‹ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

å®Ÿéš›ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ä½œã£ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã‚·ã‚§ã‚¢ã—ãŸã‚‚ã®ã®ä¾‹ã¯ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
[Markdownã§Slideã‚’ä½œã£ã¦ç°¡å˜ã«ã‚·ã‚§ã‚¢ã§ãã‚‹ï¼ï¼Slidevookã®ä½¿ã„æ–¹](https://slidevook.dev/pages/publicVook/?id=7320ef2b-9a5f-4a4b-87d2-329dc0be04ac&uuid=341ec00c-d457-4c29-bb48-75fe6667c39a&suid=6fd92b24-514d-4cab-91b8-5311353a3ee0)

![SlideExample](https://storage.googleapis.com/zenn-user-upload/68a23dc3262a-20230403.png)
ã“ã‚“ãªæ„Ÿã˜ã®ãŠã—ã‚ƒã‚Œãªã‚¹ãƒ©ã‚¤ãƒ‰ã‚’Markdownå½¢å¼ã§ã¤ãã£ã¦ã€ç°¡å˜ã«ã‚·ã‚§ã‚¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚µãƒ¼ãƒ“ã‚¹ã®ç´¹ä»‹ã‚„ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãªéƒ¨åˆ†ã¯ã€[å¥½ãã ã£ãŸSlideShaâ—‹eãŒæ‚²ã—ã„UXã«ãªã£ã¦ã„ãŸã®ã§ã€ãã®æ€’ã‚Šã‚’ç³§ã«Slideã®ä½œæˆãƒ»å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’çˆ†èª•ã•ã›ãŸè©±](https://zenn.dev/1227yukimura/articles/25904233479771)â†ã“ã¡ã‚‰ã®è¨˜äº‹ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚åˆ©ç”¨ã§ãã‚‹ã§ã‚‚ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹ã®ã§ã‚ˆã‹ã£ãŸã‚‰ã€è§¦ã£ã¦ã¿ã¦ãã ã•ã„ã€‚
[(PCç‰ˆChromeãƒ–ãƒ©ã‚¦ã‚¶æ¨å¥¨)Demoãƒšãƒ¼ã‚¸ã¯ã“ã¡ã‚‰](https://slidevook.dev/pages/demo/)
ã¾ãŸã€ä¸»è¦ãªéƒ¨åˆ†(sli.devã€WebContainer APIã®åˆ©ç”¨ç®‡æ‰€)ã¯ã€OSSã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚[slidevook/slidevook-core](https://github.com/slidevook/slidevook-core)

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€æŠ€è¡“çš„ãªæŒ‘æˆ¦ã¨ã—ã¦ã€æ¥µåŠ›ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§å®Œçµã—ã¦ã€ä½œã‚Šä¸Šã’ã‚‹ã¨ã„ã†ãƒ†ãƒ¼ãƒã§é–‹ç™ºã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã€AWS Amplifyã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã€å‹•çš„OGPã‚’è¿”å´ã™ã‚‹ãŸã‚ã«Lamda@Edgeç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¡ã‚‡ã£ã¨æ›¸ã„ãŸã®ã¨ã€GraphQLç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒã‚’è¨­å®šã—ãŸä»¥å¤–ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¸€åˆ‡æ›¸ã„ã¦ãŠã‚‰ãšã€**ã»ã¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æŠ€è¡“ã§å®Ÿç¾**ã—ã¦ã„ã¾ã™ã€‚
ä½™è«‡ã§ã™ãŒã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½œã£ã¦ã„ãŸã¨ãã¯ã€WebSocketã‚’ä½¿ã£ã¦å®Ÿç¾ã—ã¦ã„ãŸã®ã§ã€WebSockerã‚µãƒ¼ãƒãƒ¼ç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚´ãƒªã‚´ãƒªæ›¸ã„ã¦ã„ãŸã®ã§ã™ãŒã€Wasmãƒ™ãƒ¼ã‚¹ã®WebContainerã«ã‚ˆã‚Šã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸€æƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

å‰è¿°ã®é€šã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ã¯ã€ã»ã¼ã™ã¹ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘ã‘ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ããã£ã¦ã—ã¾ã†ã¨ã€å¹…ãŒåºƒã™ãã‚‹ãŸã‚ã€æä¾›ã—ã¦ã„ã‚‹æ©Ÿèƒ½ã‚’è»¸ã«ã€è¦ç´ ã¨ãªã‚‹æŠ€è¡“ã‚’ç´¹ä»‹ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ç­‰ã®ãƒ™ãƒ¼ã‚¹éƒ¨åˆ†(Vite,TypeScript,React)

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã¯ã€[Vite](https://ja.vitejs.dev/)ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
[Viteã®ç‰¹å¾´](https://ja.vitejs.dev/guide/features.html)

![ViteLogo](https://storage.googleapis.com/zenn-user-upload/db213f658dbe-20230403.png  =128x)

æ­£ç›´ãªã¨ã“ã‚ã€Viteã‚’åˆ©ç”¨ã—ã¦ã„ãªã‹ã£ãŸã‚‰é€”ä¸­ã§æŒ«æŠ˜ã—ã¦ã„ãŸã ã‚ã†ãªã¨ã„ã†ãã‚‰ã„å¤§ããªå­˜åœ¨ã§ã—ãŸã€‚éå¸¸ã«é«˜é€Ÿã§ã€è¨­å®šã‚‚ã—ã‚„ã™ã„ã§ã™ã€‚
ãƒ¡ã‚¤ãƒ³ã®ä»•äº‹ã§ã¯ã€Webpackã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã™ãŒã€ã‚‚ã—Webpackã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã§ã€Viteã‚’åˆ©ç”¨ã—ãŸã“ã¨ãŒç„¡ã„ã¨ã„ã†æ–¹ã¯ã€æ¥µã‚ã¦å„ªç§€ãªãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ãªã®ã§ã€**æ˜¯éã„ã¾ã™ãæˆ¯ã‚Œã¦ã»ã—ã„**ãªã£ã¦æ€ã„ã¾ã™ã€‚


`npm create vite@latest` ã§ã€[React](https://ja.reactjs.org/)ã€[TypeScript](https://www.typescriptlang.org/)ç”¨ã®ã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸã ã‘ã§ã€ç‰¹ã«æŠ€è¡“çš„ãªãƒˆãƒ”ãƒƒã‚¯ã¯ãªã„ã®ã§ã€æ°—ã«ãªã‚‹æ–¹ã¯ã€ãœã² [Viteã®å…¬å¼ã‚¬ã‚¤ãƒ‰](https://ja.vitejs.dev/guide/) ã‚’å‚ç…§ã—ã¾ã—ã‚‡ã†ã€‚

ã¾ãŸã€ä»Šè¿°ã¹ãŸã¨ãŠã‚Šã€
[TypeScript](https://www.typescriptlang.org/) ![TypeScript](https://storage.googleapis.com/zenn-user-upload/73011d6e0b06-20230404.png =128x)

[React](https://ja.reactjs.org/) ![React](https://storage.googleapis.com/zenn-user-upload/1fcc32cd9146-20230404.png =128x)

ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ãŸã‚Šã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã ã¨æ€ã„ã¾ã™ã®ã§ã€ã“ã®è¨˜äº‹ã§ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚

### UIå‘¨ã‚Š

UIå‘¨ã‚Šã§ã¯ã€ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

- [PrimeReact](https://github.com/primefaces/primereact)
  - ãƒœã‚¿ãƒ³ã‚„ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ãªã©ã€åŸºæœ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ©ç”¨
  - ç‰¹ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ„ãƒªãƒ¼ä¸Šã«è¡¨ç¤ºã™ã‚‹ [Treeã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](https://primereact.org/tree/) ã¯ã‚ã‚ŠãŒãŸã‹ã£ãŸã§ã™
  - å‹ã‚‚æä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è¿·ã†ã“ã¨ãªãçŸ­æ™‚é–“ã§ä¸å…·åˆãªãå®Ÿè£…ã§ãã‚‹ã®ã§ãŠã™ã™ã‚ã§ã™
![](https://storage.googleapis.com/zenn-user-upload/2f97e142f765-20230404.gif =256x)
- [PrimeIcons](https://github.com/primefaces/primeicons)
  - iconç³»ã¯ã€PrimeIconã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
  - ã“ã“ã¯ã€ç‰¹ã«æ·±ã„ç†ç”±ã¯ãªãã€PrimeReactã‚’ä½¿ã£ãŸã¤ã„ã§ã¨ã„ã£ãŸæ„Ÿã˜ã§é¸ã³ã¾ã—ãŸ
  - ã‚‚ã—ã€PrimeReactã‚’ä½¿ã£ã¦ã„ãªã‹ã£ãŸã‚‰ã€[iconsax](https://iconsax.io/) ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†ã‹ãªã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒã‚¤ãƒã‚¤ãƒã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§ä½¿ã£ã¦ã„ã¾ã›ã‚“ã€‚
- [PrimeFlex](https://github.com/primefaces/primeflex)
  - CSS Utilityç³»ã¯ã€PrimeFlexã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
  - ã“ã“ã‚‚ã€ç‰¹ã«æ·±ã„ç†ç”±ã¯ãªãã€PrimeReactã‚’ä½¿ã£ãŸã¤ã„ã§ã¨ã„ã£ãŸæ„Ÿã˜ã§é¸ã³ã¾ã—ãŸ
  - ã‚‚ã—ã€PrimeReactã‚’ä½¿ã£ã¦ã„ãªã‹ã£ãŸã‚‰ã€[WindiCSS](https://windicss.org/) ã‚’ä½¿ã£ã¦ã„ãŸã¨æ€ã„ã¾ã™ã€‚
- [react-mosaic](https://github.com/nomcopter/react-mosaic)
  - FileTreeã‚„Editorã®é ˜åŸŸã‚’å¯å¤‰ã«ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™
  - â€» ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®ã¨ãã®åæ®‹ã‚Šã§ã€PrimeReactãŒæä¾›ã™ã‚‹ [splitterã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](https://primereact.org/splitter/) ã§ååˆ†ãªã®ã§ã€å‰Šé™¤ã™ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚
- [Monaco Editor](https://github.com/microsoft/monaco-editor)
  - ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼éƒ¨åˆ†ã®å®Ÿè£…ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™
  - VSCodeã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã€è¶…æœ‰åãªã‚¨ãƒ‡ã‚£ã‚¿ã§ã™ã­ã€‚
  - åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€å‹ãŒå……å®Ÿã—ã¦ã„ã‚‹ã®ã§ã€ãŠã™ã™ã‚ã§ã™ã€‚
ä»¥ä¸‹ã®å®Ÿè£…ã§ç¤ºã—ãŸã‚ˆã†ã«ã€ç”»åƒã®åæ˜ æ©Ÿèƒ½(GitHubã®ç”»åƒè²¼ã‚Šä»˜ã‘æ©Ÿèƒ½ã®ã‚ˆã†ã«ã€Markdownã¨ã—ã¦ã®ç”»åƒå‚ç…§ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¤ã¤ã€è£å´ã§ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½)ã‚’ã•ã•ã£ã¨ä½œã‚Œã‚‹ãªã©ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ãŒé«˜ã„ã®ã‚‚ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆã§ã™ã­

```ts
// ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ãƒšãƒ¼ã‚¹ãƒˆæ™‚ã«ç”»åƒã®å ´åˆã¯ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ç”»åƒå‚ç…§ç”¨ã®æ–‡å­—åˆ—ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«åæ˜ ã™ã‚‹
const pasteHandler = async (event:ClipboardEvent) => {
  if(event.clipboardData && event.clipboardData.items) {
    const clipboardItem = event.clipboardData.items[0];
    if (clipboardItem.type.startsWith("image/")) {
      event.preventDefault();  // NOTE: prevent monaco editor original paste event
      event.stopPropagation(); // NOTE: prevent monaco editor original paste event
      const uploadedImageFileRelativePath = await uploadImageFile(props.getWebcontainerInstance(), clipboardItem.getAsFile(), workspaceContextValue);
      props.kickReloadFile()
      if( uploadedImageFileRelativePath ) {
        const editor = editorRef.current;
        var line = editor.getPosition();
        if(line) {
          var range = new monaco.Range(line.lineNumber, 1, line.lineNumber, 1);
          var id = { major: 1, minor: 1 };
          var text = `![](${uploadedImageFileRelativePath})`;
          var op = {identifier: id, range: range, text: text, forceMoveMarkers: true};
          editor.executeEdits(null, [op]);
        }
      }
    }
  }
}

// ã€œä¸­ç•¥ã€œ
// pasteã‚¤ãƒ™ãƒ³ãƒˆã«ç‹¬è‡ªã®pasteHandlerã‚’è¿½åŠ 
editorElement.addEventListener('paste', pasteHandler, { capture: true });
```

### Wasmé–¢é€£

ä»Šå›ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ã»ã¼ä½œã‚‰ãšã«ä½œã‚Šãã‚ŒãŸã®ã¯ã€WebAssemblyãŒã€å®Ÿç”¨ã«è€ãˆã‚‰ã‚Œã‚‹ã¨ã“ã‚ã¾ã§é€²åŒ–ã—ã¦ã„ãŸã“ã¨ã«ä»–ãªã‚Šã¾ã›ã‚“ã€‚

#### WebContainerã«ã¤ã„ã¦

**ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã€NodeJSãŒå‹•ãã€WebContainerã¯ã€éå¸¸ã«å¼·åŠ›**ã§ã™ã€‚WebContainerãŒãªã‘ã‚Œã°ã€[XTerm.js](https://xtermjs.org/) x [Fastify](https://www.fastify.io/) ã«ã‚ˆã‚‹[WebSocket](https://socket.io/)ã‚µãƒ¼ãƒ æ§‹æˆã§ä½œã£ã¦ã„ãŸã¨æ€ã„ã¾ã™ã€‚â€» ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã¯ã€ã“ã®æ§‹æˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚

WebContainerã«é–¢ã—ã¦ã¯ã€[ãˆã£ï¼ŸBrowserå†…ã§Node.jsã‚¢ãƒ—ãƒªãŒå‹•ãï¼Ÿï¼Ÿ WebContainerAPIã‚’TypeScriptã§å‹•ã‹ã—ã¦ã¿ãŸ](https://zenn.dev/1227yukimura/articles/9a96f4435f65eb) ã§ç´¹ä»‹ã—ã¦ã„ã‚‹ã®ã§ã€ã‚ˆã‹ã£ãŸã‚‰ãã¡ã‚‰ã‚‚ã”å‚ç…§ãã ã•ã„ã€‚
ã¾ãŸã€[slidevook/slidevook-core](https://github.com/slidevook/slidevook-core) ã«ã¦ã€WebContaineréƒ¨åˆ†ã¨ã€WebContainerä¸Šã§å‹•ã‹ã—ã¦ã„ã‚‹ã€Markdownã§ä½œã£ãŸslideã‚’å‹•ã‹ã™ãŸã‚ã®ã€[Slidev](https://sli.dev/) ç”¨ã®å®Ÿè£…éƒ¨åˆ†ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

#### å‹•çš„OGPã®ç”Ÿæˆ

![DynamicOGP](https://storage.googleapis.com/zenn-user-upload/e6b773374635-20230404.gif)

å‹•çš„ã«OGPã‚’ç”Ÿæˆã™ã‚‹ã«ã‚ãŸã£ã¦ã¯ã€Vercelè£½ã®ã€[satori](https://github.com/vercel/satori) ã‚’åˆ©ç”¨ã—ã¦å‹•çš„ã«OGPã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚
satoriãŒç´ æ™´ã‚‰ã—ã„ã®ã¯ã€[Wasmã¨ã—ã¦ã‚‚æä¾›](https://github.com/vercel/satori#runtime-and-wasm)ã•ã‚Œã¦ãŠã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ç”»åƒç”ŸæˆãŒã§ãã¦ã€ãªãŠã‹ã¤è»½é‡ã«å‹•ä½œã™ã‚‹ã“ã¨ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
æ³¨æ„ç‚¹ãŒã‚ã‚‹ã¨ã™ã‚‹ã¨ã€MITã‚„Apache 2.0ã®ã‚ˆã†ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ã¯ãªãã€Mozilla Public License 2.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãªã®ã§ã€MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨æ¯”ã¹ã‚‹ã¨åˆ¶é™ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã‹ã€‚
ä»Šå›ã¯ã€Viteã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®Reactãƒšãƒ¼ã‚¸ã§æ§‹æˆã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ç”Ÿæˆã—ãŸOGPã‚’ã‚·ã‚§ã‚¢æ™‚ã«<og:image>ã¨ã—ã¦ã€æä¾›ã™ã‚‹ã«ã‚ãŸã£ã¦ã€twitterã®ãƒœãƒƒãƒˆã¯ã€JavaScriptã‚’è§£é‡ˆã—ã¦ãã‚Œãªã„ã®ã§ã€ãã“ã ã‘ã¯ã€AWSã®Lambda@Edgeã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚(ä»–ã«ã¯ã€ServerSideRenderingã¨ã„ã†ä½œæˆ¦ã‚‚ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚’æ¥µåŠ›ç„¡ãã™æŒ‘æˆ¦ã‚’ã—ã¦ã„ã‚‹ã®ã§ã€æ¡ç”¨ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚)

å‚è€ƒã¾ã§ã«ã€satoriã‚’åˆ©ç”¨ã—ãŸOGPã®ä½œæˆã‚³ãƒ¼ãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```ts
import satori from 'satori';

// å´©ã‚Œãªã„ã‚ˆã†ã«ä¸€å®šã‚µã‚¤ã‚ºä»¥ä¸Šã®æ–‡å­—åˆ—ã‚’çœç•¥ã™ã‚‹
const elipsisStringIfSizeOver = ({originalString = '', maxFullSize = 0}) => {
  let halfSizeStringLength = 0;
  let fullSizeStringLength = 0;
  for (let i = 0; i < originalString.length; i++) {
    if(originalString[i].match(/[ -~]/) ) {
      halfSizeStringLength++;
    } else {
      fullSizeStringLength++;
    }

    const totalSize = halfSizeStringLength * 0.5 + fullSizeStringLength;

    if( totalSize > maxFullSize ) {
      return `${originalString.substring(0, i-1)}..`;
    }
  }
  return originalString;
}

export const OgpSize = { width: 1200, height: 630 } as const;
const FrameWidth = 24;
const BottomAreaHeight = 80;
const TitleAreaPadding = 24;

export const generateOgpSVG = async ({fontData = new ArrayBuffer(8), title = '', userName = '', avatarUrl = ''}) => {
  const ogpTitle = title !== '' ? title : 'No-Title';

  const svg = await satori(
    <div
      style={{
        background: '#000',
        display: 'flex',
        height: '100%',
        paddingLeft: FrameWidth,
        paddingTop: FrameWidth,
        width: '100%',
      }}
    >
      <div
        style={{
          backgroundColor: '#FFF',
          display: 'flex',
          flexDirection: 'column',
          justifyContent: 'space-between',
          fontWeight: 600,
          padding: 24,
          width: '100%',
        }}
      >
        <div style={{
          display: 'flex',
          alignItems: 'center',
          height: OgpSize.height - FrameWidth - TitleAreaPadding*2 - BottomAreaHeight,
          padding: 16,
        }}>
          <div style={{ fontSize: 64 }}>
            {elipsisStringIfSizeOver({originalString: ogpTitle, maxFullSize: 68})}
          </div>
        </div>
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          height: BottomAreaHeight,
        }}>
          <div style={{
            fontSize: 48,
            display: 'flex',
            alignItems: 'center',
            height: BottomAreaHeight,
          }}>
            { avatarUrl &&
              <img
                src={avatarUrl}
                width={80}
                height={BottomAreaHeight}
                style={{ borderRadius: 50, marginRight: 24 }}
              />
            }
            {elipsisStringIfSizeOver({originalString: userName, maxFullSize: 20})}
          </div>
          <div style={{ display: 'flex'}}>
            <img
              src="slidevook-title.png"
              height={BottomAreaHeight}
              width={353}
            />
          </div>
        </div>
      </div>
    </div>
    ,
    {
      width: OgpSize.width,
      height: OgpSize.height,
      fonts: [
        {
          name: "Noto Serif JP",
          data: fontData,
          style: 'normal',
        },
      ],
    },
  )
  return svg;
}
```

### ãã®ä»–

é€šä¿¡ãŒé€”åˆ‡ã‚ŒãŸæ™‚ã§ã‚‚ã€ãªã‚‹ã¹ãæƒ…å ±ãŒæãªã‚ã‚Œãªã„ã‚ˆã†ã«ã—ãŸã‹ã£ãŸã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç”»åƒã‚„æ–‡ç« ï¼‰ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã¨ã—ã¦ã¯ã€å¤ãã‹ã‚‰å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹LocalStorageãŒæœ‰åã‹ã¨æ€ã„ã¾ã™ãŒã€LocalStorageã¯ã€æœ€å¤§ã§5MBã¾ã§ã¨ã„ã†åˆ¶é™ãŒã‚ã‚Šã€è¤‡æ•°ã‚¹ãƒ©ã‚¤ãƒ‰ç”¨ã®è¤‡æ•°ç”»åƒã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã€é©åˆ‡ãªé¸æŠè‚¢ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ãã®ãŸã‚ã€[IndexedDB](https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API) ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚[can i use IndexedDB](https://caniuse.com/indexeddb) ã§èª¿ã¹ã¦ã‚‚ã€å¤§åŠã®ãƒ–ãƒ©ã‚¦ã‚¶ãŒå®Ÿè£…ã—ã¦ãŠã‚Šã€ã“ã¡ã‚‰ã‚‚å®Ÿç”¨ã«è€ãˆã‚‰ã‚Œã‚‹ã¨ã“ã‚ã¾ã§é€²åŒ–ã—ã¦ã„ã‚‹ã“ã¨ã«é©šãã¾ã—ãŸã€‚IndexedDBã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸èª¿ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ããªã‹ã£ãŸå ´åˆã§ã‚‚ã€IndexedDBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©æ—§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

IndexedDBã‚’å–ã‚Šæ‰±ã†ã«ã‚ãŸã£ã¦ã€[Dexie.js](https://dexie.org/) ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚èª­ã¿æ–¹ãŒã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã€è„³å†…ã§ã¯ã€ã€Œãƒ‡ãƒ¥ã‚¯ã‚·ã€ãƒ‡ãƒ¥ã‚¯ã‚·ã€ãƒ‡ãƒ¥ã‚¯ã‚·ã€ã¨å‘¼ã‚“ã§ã„ãŸã®ã¯ã€å†…ç·’ã§ã™(ç¬‘)

ä¾‹ãˆã°ã€ç”»åƒã®ä¿å­˜éƒ¨åˆ†ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã‹ãªã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import Dexie, { Table } from "dexie";
import { ImageAssetTableIndex, ImageAssetTableType } from "./ImageAssets";

class WorkspaceDatabase extends Dexie {
  imageAssets!: Table<ImageAssetTableType>;

  constructor(workspaceId:string) {
    super(workspaceId); // NOTE: create database;
    this.version(1).stores({
      imageAssets: ImageAssetTableIndex,
    });
  }
}

export const workspaceDatabase = (workspaceId:string) => new WorkspaceDatabase(workspaceId);
```

```ts
import { workspaceDatabase } from "./WorkspaceDatabase";

export type ImageAssetTableType = {
  path: string,
  content: Uint8Array,
};

export const ImageAssetTableIndex ='path';

export const saveImageToIndexedDB = (workspace:string, acutualFilePath:string, content:Uint8Array) => {
  workspaceDatabase(workspace).imageAssets.put({
    path: acutualFilePath,
    content: content,
  });
}

export const listAllImagesFromIndexedDB = async (workspace:string) => {
  return workspaceDatabase(workspace).imageAssets.toArray();
}
```

### ãƒ­ã‚´ãƒ‡ã‚¶ã‚¤ãƒ³

- ãƒ­ã‚´ã‚„ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ã€AIã«å¤šã€…ãƒªãƒ†ã‚¤ã‚¯ã—ã¦ã¤ãã£ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸ
  - [https://brandmark.io/](https://brandmark.io/)
  - $ 65 ã§è³¼å…¥ã—ã¾ã—ãŸ
  - å˜ç´”ãªãƒ­ã‚´ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§ãªãã€Tã‚·ãƒ£ãƒ„ã‚„ãƒãƒƒã‚°ã€ã‚¹ãƒãƒ•ã‚©ã‚¢ãƒ—ãƒªãªã©ã®ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚µãƒ³ãƒ—ãƒ«ã‚‚ä½œã£ã¦ãã‚Œã‚‹ã®ã§ã€ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒçˆ†ä¸ŠãŒã‚Šã™ã‚‹ã®ã§ã€æœ€åˆã«èµ·çˆ†å‰¤ã¨ã—ã¦ã‚„ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚

â†“ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä¾‹ã§ã™ã€‚ã“ã‚Œã ã‘ã§ã©ã‚“ã¶ã‚Šã‚ã—ï¼“æ¯ã¯ã„ã‘ã¾ã™ã­(ç¬‘)
![mockaup](https://storage.googleapis.com/zenn-user-upload/a17999e55666-20230404.png)

## ãŠã‚ã‚Šã«

ã“ã“æœ€è¿‘ã¤ãã£ã¦ã„ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã€æŠ€è¡“ã‚’ç¶²ç¾…çš„ã«ç´¹ä»‹ã—ã¦ã¿ã¾ã—ãŸã€‚æ›¸ãå‡ºã—ã¦ã¿ã‚‹ã¨ã€ã‚¢ãƒ¬ã‚³ãƒ¬ã‚„ã£ã¦ã„ã¾ã™ãŒã€ã‚„ã¯ã‚Šå¤§ãã„ã®ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã„ã†é ˜åŸŸãŒã©ã‚“ã©ã‚“é€²åŒ–ã—ã¦ãã¦ãŠã‚Šã€ç‰¹ã«WebAssemblyã«ã‚ˆã£ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸–ç•ŒãŒã€è‘—ã—ãåºƒãŒã£ã¦ã„ã‚‹ãªã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚
æŠ€è¡“çš„ãªé€²æ­©ãŒæ—©ãã€ä¹±ä¸–ï¼ï¼ã£ã¦æ„Ÿã˜ãŒã—ã¾ã™ãŒã€ãªã‚‹ã¹ãæŠ€è¡“ã«å¯„ã‚Šæ·»ã„ãªãŒã‚‰ã€æœ€å¾Œã¯ã€ã€Œã“ã‚Œã ã‹ã‚‰ä¹±ä¸–ã¯é¢ç™½ã„ã€ã¨ç¬‘ã„ãªãŒã‚‰ã€æ¬¡ä¸–ä»£ã«ãƒãƒˆãƒ³ã‚’ã¤ãªãã¦ã„ããŸã„ã‚‚ã®ã§ã™ã€‚
